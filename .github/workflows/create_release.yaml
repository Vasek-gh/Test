name: "Create release"

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  Build:
    name: Main
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Fetch tags
        run: git fetch --tags

      - id: get_last_release_tag
        name: Get last release tag
        run: echo "lastTag=$(git describe --tags $(git rev-list --tags --max-count=1))" >> $GITHUB_OUTPUT

      - id: get_notes_info
        name: Get notes info
        uses: actions/github-script@v7
        env:
          GH_TOKEN: ${{ github.token }}
        with:
          result-encoding: string
          script: |
            const fs = require('node:fs');
            const script = require('./.github/scripts/get_notes_info.js');

            return await script({
              core: core,
              fs: fs,
              changelog: '${{ steps.read_changelog.outputs.changelog }}'
            });

      - name: Echo dgb
        run:  |
          echo ${{ steps.get_last_release_tag.outputs.lastTag }}
          echo ${{ steps.get_notes_info.outputs.result.version }}
          echo ${{ steps.get_notes_info.outputs.result.notes }}